import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import { generateRandomId } from '../../helpers/id.helper';
import { ScriptLoaderService } from '../../services/script-loader.service';
import { FilterType } from '../../types/control-type';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/script-loader.service';
export class ControlWrapperComponent {
    constructor(loaderService) {
        this.loaderService = loaderService;
        /**
         * Emits when an error occurs when attempting to render the control.
         */
        this.error = new EventEmitter();
        /**
         * The control is ready to accept user interaction and for external method calls.
         *
         * Alternatively, you can listen for a ready event on the dashboard holding the control
         * and call control methods only after the event was fired.
         */
        this.ready = new EventEmitter();
        /**
         * Emits when the user interacts with the control, affecting its state.
         * For example, a `stateChange` event will be emitted whenever you move the thumbs of a range slider control.
         *
         * To retrieve an updated control state after the event fired, call `ControlWrapper.getState()`.
         */
        this.stateChange = new EventEmitter();
        /**
         * A generated id assigned to this components DOM element.
         */
        this.id = generateRandomId();
        this.wrapperReadySubject = new ReplaySubject(1);
    }
    /**
     * Emits after the `ControlWrapper` was created.
     */
    get wrapperReady$() {
        return this.wrapperReadySubject.asObservable();
    }
    get controlWrapper() {
        if (!this._controlWrapper) {
            throw new Error(`Cannot access the control wrapper before it being initialized.`);
        }
        return this._controlWrapper;
    }
    ngOnInit() {
        this.loaderService.loadChartPackages('controls').subscribe(() => {
            this.createControlWrapper();
        });
    }
    ngOnChanges(changes) {
        if (!this._controlWrapper) {
            return;
        }
        if (changes.type) {
            this._controlWrapper.setControlType(this.type);
        }
        if (changes.options) {
            this._controlWrapper.setOptions(this.options || {});
        }
        if (changes.state) {
            this._controlWrapper.setState(this.state || {});
        }
    }
    createControlWrapper() {
        this._controlWrapper = new google.visualization.ControlWrapper({
            containerId: this.id,
            controlType: this.type,
            state: this.state,
            options: this.options
        });
        this.addEventListeners();
        this.wrapperReadySubject.next(this._controlWrapper);
    }
    addEventListeners() {
        google.visualization.events.removeAllListeners(this._controlWrapper);
        google.visualization.events.addListener(this._controlWrapper, 'ready', (event) => this.ready.emit(event));
        google.visualization.events.addListener(this._controlWrapper, 'error', (event) => this.error.emit(event));
        google.visualization.events.addListener(this._controlWrapper, 'statechange', (event) => this.stateChange.emit(event));
    }
}
ControlWrapperComponent.ɵfac = function ControlWrapperComponent_Factory(t) { return new (t || ControlWrapperComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ScriptLoaderService)); };
ControlWrapperComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ControlWrapperComponent, selectors: [["control-wrapper"]], hostAttrs: [1, "control-wrapper"], hostVars: 1, hostBindings: function ControlWrapperComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵhostProperty("id", ctx.id);
    } }, inputs: { for: "for", type: "type", options: "options", state: "state" }, outputs: { error: "error", ready: "ready", stateChange: "stateChange" }, exportAs: ["controlWrapper"], features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 0, vars: 0, template: function ControlWrapperComponent_Template(rf, ctx) { }, encapsulation: 2, changeDetection: 0 });
ControlWrapperComponent.ctorParameters = () => [
    { type: ScriptLoaderService }
];
ControlWrapperComponent.propDecorators = {
    for: [{ type: Input }],
    type: [{ type: Input }],
    options: [{ type: Input }],
    state: [{ type: Input }],
    error: [{ type: Output }],
    ready: [{ type: Output }],
    stateChange: [{ type: Output }],
    id: [{ type: HostBinding, args: ['id',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ControlWrapperComponent, [{
        type: Component,
        args: [{
                selector: 'control-wrapper',
                template: '',
                host: { class: 'control-wrapper' },
                exportAs: 'controlWrapper',
                changeDetection: ChangeDetectionStrategy.OnPush
            }]
    }], function () { return [{ type: ɵngcc1.ScriptLoaderService }]; }, { error: [{
            type: Output
        }], ready: [{
            type: Output
        }], stateChange: [{
            type: Output
        }], id: [{
            type: HostBinding,
            args: ['id']
        }], for: [{
            type: Input
        }], type: [{
            type: Input
        }], options: [{
            type: Input
        }], state: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC13cmFwcGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hbmd1bGFyLWdvb2dsZS1jaGFydHMvc3JjL2xpYi9jb21wb25lbnRzL2NvbnRyb2wtd3JhcHBlci9jb250cm9sLXdyYXBwZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUdMLE1BQU0sRUFFUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXJDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzNELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7O0FBV3RELE1BQU0sT0FBTyx1QkFBdUI7QUFBRyxJQW1GckMsWUFBb0IsYUFBa0M7QUFBSSxRQUF0QyxrQkFBYSxHQUFiLGFBQWEsQ0FBcUI7QUFBQyxRQWpDdkQ7QUFDRjtBQUVBLFdBREs7QUFDTCxRQUNTLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztBQUNyRCxRQUNFO0FBQ0Y7QUFFQztBQUFXO0FBQ007QUFHWixXQUZEO0FBQ0wsUUFDUyxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7QUFDckQsUUFDRTtBQUNGO0FBQ007QUFFQztBQUFXO0FBR1osV0FGRDtBQUNMLFFBQ1MsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO0FBQ25ELFFBQ0U7QUFDRjtBQUVBLFdBREs7QUFDTCxRQUNrQixPQUFFLEdBQUcsZ0JBQWdCLEVBQUUsQ0FBQztBQUMxQyxRQUVVLHdCQUFtQixHQUFHLElBQUksYUFBYSxDQUFzQyxDQUFDLENBQUMsQ0FBQztBQUMxRixJQUMyRCxDQUFDO0FBQzVELElBQ0U7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLElBQVcsYUFBYTtBQUMxQixRQUFJLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxDQUFDO0FBQ25ELElBQUUsQ0FBQztBQUNILElBQ0UsSUFBVyxjQUFjO0FBQUssUUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUU7QUFDL0IsWUFBTSxNQUFNLElBQUksS0FBSyxDQUFDLGdFQUFnRSxDQUFDLENBQUM7QUFDeEYsU0FBSztBQUNMLFFBQ0ksT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO0FBQ2hDLElBQUUsQ0FBQztBQUNILElBQ1MsUUFBUTtBQUNqQixRQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtBQUNwRSxZQUFNLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO0FBQ2xDLFFBQUksQ0FBQyxDQUFDLENBQUM7QUFDUCxJQUFFLENBQUM7QUFDSCxJQUNTLFdBQVcsQ0FBQyxPQUFzQjtBQUFJLFFBQzNDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFO0FBQy9CLFlBQU0sT0FBTztBQUNiLFNBQUs7QUFDTCxRQUNJLElBQUksT0FBTyxDQUFDLElBQUksRUFBRTtBQUN0QixZQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNyRCxTQUFLO0FBQ0wsUUFDSSxJQUFJLE9BQU8sQ0FBQyxPQUFPLEVBQUU7QUFDekIsWUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQzFELFNBQUs7QUFDTCxRQUNJLElBQUksT0FBTyxDQUFDLEtBQUssRUFBRTtBQUN2QixZQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQUM7QUFDdEQsU0FBSztBQUNMLElBQUUsQ0FBQztBQUNILElBQ1Usb0JBQW9CO0FBQzlCLFFBQUksSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDO0FBQ25FLFlBQU0sV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFO0FBQzFCLFlBQU0sV0FBVyxFQUFFLElBQUksQ0FBQyxJQUFJO0FBQzVCLFlBQU0sS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO0FBQ3ZCLFlBQU0sT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO0FBQzNCLFNBQUssQ0FBQyxDQUFDO0FBQ1AsUUFDSSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztBQUM3QixRQUFJLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ3hELElBQUUsQ0FBQztBQUNILElBQ1UsaUJBQWlCO0FBQzNCLFFBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ3pFLFFBQ0ksTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsT0FBTyxFQUFFLENBQUMsS0FBc0IsRUFBRSxFQUFFLENBQ2hHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUN2QixDQUFDO0FBQ04sUUFBSSxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxLQUFzQixFQUFFLEVBQUUsQ0FDaEcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQ3ZCLENBQUM7QUFDTixRQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLGFBQWEsRUFBRSxDQUFDLEtBQWMsRUFBRSxFQUFFLENBQzlGLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUM3QixDQUFDO0FBQ04sSUFBRSxDQUFDO0FBQ0g7bURBNUpDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsaUJBQWlCLGtCQUMzQixRQUFRLEVBQUUsRUFBRSxrQkFDWixJQUFJLEVBQUUsRUFBRSxLQUFLO0FBQUUsaUJBQWlCLEVBQUUsa0JBQ2xDLFFBQVEsRUFBRSxnQkFBZ0Isa0JBQzFCLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNLGNBQ2hEOztnV0FDSTtBQUFDO0FBQWlELFlBWjlDLG1CQUFtQjtBQUFHO0FBQUc7QUFDakMsa0JBZUUsS0FBSztBQUNOLG1CQVlDLEtBQUs7QUFDTixzQkFZQyxLQUFLO0FBQ04sb0JBZ0JDLEtBQUs7QUFDTixvQkFLQyxNQUFNO0FBQ1Asb0JBUUMsTUFBTTtBQUNQLDBCQVFDLE1BQU07QUFDUCxpQkFLQyxXQUFXLFNBQUMsSUFBSTtBQUNmOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBnZW5lcmF0ZVJhbmRvbUlkIH0gZnJvbSAnLi4vLi4vaGVscGVycy9pZC5oZWxwZXInO1xuaW1wb3J0IHsgU2NyaXB0TG9hZGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3NjcmlwdC1sb2FkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBGaWx0ZXJUeXBlIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29udHJvbC10eXBlJztcbmltcG9ydCB7IENoYXJ0RXJyb3JFdmVudCwgQ2hhcnRSZWFkeUV2ZW50IH0gZnJvbSAnLi4vLi4vdHlwZXMvZXZlbnRzJztcbmltcG9ydCB7IENoYXJ0QmFzZSB9IGZyb20gJy4uL2NoYXJ0LWJhc2UvY2hhcnQtYmFzZS5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjb250cm9sLXdyYXBwZXInLFxuICB0ZW1wbGF0ZTogJycsXG4gIGhvc3Q6IHsgY2xhc3M6ICdjb250cm9sLXdyYXBwZXInIH0sXG4gIGV4cG9ydEFzOiAnY29udHJvbFdyYXBwZXInLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBDb250cm9sV3JhcHBlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgLyoqXG4gICAqIENoYXJ0cyBjb250cm9sbGVkIGJ5IHRoaXMgY29udHJvbCB3cmFwcGVyLiBDYW4gYmUgYSBzaW5nbGUgY2hhcnQgb3IgYW4gYXJyYXkgb2YgY2hhcnRzLlxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIGZvciE6IENoYXJ0QmFzZSB8IENoYXJ0QmFzZVtdO1xuXG4gIC8qKlxuICAgKiBUaGUgY2xhc3MgbmFtZSBvZiB0aGUgY29udHJvbC5cbiAgICogVGhlIGBnb29nbGUudmlzdWFsaXphdGlvbmAgcGFja2FnZSBuYW1lIGNhbiBiZSBvbWl0dGVkIGZvciBHb29nbGUgY29udHJvbHMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIGBgYGh0bWxcbiAgICogPGNvbnRyb2wtd3JhcHBlciB0eXBlPVwiQ2F0ZWdvcnlGaWx0ZXJcIj48L2NvbnRyb2wtd3JhcHBlcj5cbiAgICogYGBgXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgdHlwZSE6IEZpbHRlclR5cGU7XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCBkZXNjcmliaW5nIHRoZSBvcHRpb25zIGZvciB0aGUgY29udHJvbC5cbiAgICogWW91IGNhbiB1c2UgZWl0aGVyIEphdmFTY3JpcHQgbGl0ZXJhbCBub3RhdGlvbiwgb3IgcHJvdmlkZSBhIGhhbmRsZSB0byB0aGUgb2JqZWN0LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBgYGBodG1sXG4gICAqIDxjb250cm9sLXdyYXBwZXIgW29wdGlvbnNdPVwieydmaWx0ZXJDb2x1bW5MYWJlbCc6ICdBZ2UnLCAnbWluVmFsdWUnOiAxMCwgJ21heFZhbHVlJzogODB9XCI+PC9jb250cm9sLXdyYXBwZXI+XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIG9wdGlvbnM/OiBvYmplY3Q7XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCBkZXNjcmliaW5nIHRoZSBzdGF0ZSBvZiB0aGUgY29udHJvbC5cbiAgICogVGhlIHN0YXRlIGNvbGxlY3RzIGFsbCB0aGUgdmFyaWFibGVzIHRoYXQgdGhlIHVzZXIgb3BlcmF0aW5nIHRoZSBjb250cm9sIGNhbiBhZmZlY3QuXG4gICAqXG4gICAqIEZvciBleGFtcGxlLCBhIHJhbmdlIHNsaWRlciBzdGF0ZSBjYW4gYmUgZGVzY3JpYmVkIGluIHRlcm0gb2YgdGhlIHBvc2l0aW9ucyB0aGF0IHRoZSBsb3cgYW5kIGhpZ2ggdGh1bWJcbiAgICogb2YgdGhlIHNsaWRlciBvY2N1cHkuXG4gICAqIFlvdSBjYW4gdXNlIGVpdGhlciBKYXZhc2NyaXB0IGxpdGVyYWwgbm90YXRpb24sIG9yIHByb3ZpZGUgYSBoYW5kbGUgdG8gdGhlIG9iamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogIGBgYGh0bWxcbiAgICogPGNvbnRyb2wtd3JhcHBlciBbc3RhdGVdPVwieydsb3dWYWx1ZSc6IDIwLCAnaGlnaFZhbHVlJzogNTB9XCI+PC9jb250cm9sLXdyYXBwZXI+XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHN0YXRlPzogb2JqZWN0O1xuXG4gIC8qKlxuICAgKiBFbWl0cyB3aGVuIGFuIGVycm9yIG9jY3VycyB3aGVuIGF0dGVtcHRpbmcgdG8gcmVuZGVyIHRoZSBjb250cm9sLlxuICAgKi9cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8Q2hhcnRFcnJvckV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBUaGUgY29udHJvbCBpcyByZWFkeSB0byBhY2NlcHQgdXNlciBpbnRlcmFjdGlvbiBhbmQgZm9yIGV4dGVybmFsIG1ldGhvZCBjYWxscy5cbiAgICpcbiAgICogQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBsaXN0ZW4gZm9yIGEgcmVhZHkgZXZlbnQgb24gdGhlIGRhc2hib2FyZCBob2xkaW5nIHRoZSBjb250cm9sXG4gICAqIGFuZCBjYWxsIGNvbnRyb2wgbWV0aG9kcyBvbmx5IGFmdGVyIHRoZSBldmVudCB3YXMgZmlyZWQuXG4gICAqL1xuICBAT3V0cHV0KClcbiAgcHVibGljIHJlYWR5ID0gbmV3IEV2ZW50RW1pdHRlcjxDaGFydFJlYWR5RXZlbnQ+KCk7XG5cbiAgLyoqXG4gICAqIEVtaXRzIHdoZW4gdGhlIHVzZXIgaW50ZXJhY3RzIHdpdGggdGhlIGNvbnRyb2wsIGFmZmVjdGluZyBpdHMgc3RhdGUuXG4gICAqIEZvciBleGFtcGxlLCBhIGBzdGF0ZUNoYW5nZWAgZXZlbnQgd2lsbCBiZSBlbWl0dGVkIHdoZW5ldmVyIHlvdSBtb3ZlIHRoZSB0aHVtYnMgb2YgYSByYW5nZSBzbGlkZXIgY29udHJvbC5cbiAgICpcbiAgICogVG8gcmV0cmlldmUgYW4gdXBkYXRlZCBjb250cm9sIHN0YXRlIGFmdGVyIHRoZSBldmVudCBmaXJlZCwgY2FsbCBgQ29udHJvbFdyYXBwZXIuZ2V0U3RhdGUoKWAuXG4gICAqL1xuICBAT3V0cHV0KClcbiAgcHVibGljIHN0YXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjx1bmtub3duPigpO1xuXG4gIC8qKlxuICAgKiBBIGdlbmVyYXRlZCBpZCBhc3NpZ25lZCB0byB0aGlzIGNvbXBvbmVudHMgRE9NIGVsZW1lbnQuXG4gICAqL1xuICBASG9zdEJpbmRpbmcoJ2lkJylcbiAgcHVibGljIHJlYWRvbmx5IGlkID0gZ2VuZXJhdGVSYW5kb21JZCgpO1xuXG4gIHByaXZhdGUgX2NvbnRyb2xXcmFwcGVyPzogZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ29udHJvbFdyYXBwZXI7XG4gIHByaXZhdGUgd3JhcHBlclJlYWR5U3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0PGdvb2dsZS52aXN1YWxpemF0aW9uLkNvbnRyb2xXcmFwcGVyPigxKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvYWRlclNlcnZpY2U6IFNjcmlwdExvYWRlclNlcnZpY2UpIHt9XG5cbiAgLyoqXG4gICAqIEVtaXRzIGFmdGVyIHRoZSBgQ29udHJvbFdyYXBwZXJgIHdhcyBjcmVhdGVkLlxuICAgKi9cbiAgcHVibGljIGdldCB3cmFwcGVyUmVhZHkkKCkge1xuICAgIHJldHVybiB0aGlzLndyYXBwZXJSZWFkeVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGNvbnRyb2xXcmFwcGVyKCk6IGdvb2dsZS52aXN1YWxpemF0aW9uLkNvbnRyb2xXcmFwcGVyIHtcbiAgICBpZiAoIXRoaXMuX2NvbnRyb2xXcmFwcGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBhY2Nlc3MgdGhlIGNvbnRyb2wgd3JhcHBlciBiZWZvcmUgaXQgYmVpbmcgaW5pdGlhbGl6ZWQuYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX2NvbnRyb2xXcmFwcGVyO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCkge1xuICAgIHRoaXMubG9hZGVyU2VydmljZS5sb2FkQ2hhcnRQYWNrYWdlcygnY29udHJvbHMnKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5jcmVhdGVDb250cm9sV3JhcHBlcigpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuX2NvbnRyb2xXcmFwcGVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXMudHlwZSkge1xuICAgICAgdGhpcy5fY29udHJvbFdyYXBwZXIuc2V0Q29udHJvbFR5cGUodGhpcy50eXBlKTtcbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlcy5vcHRpb25zKSB7XG4gICAgICB0aGlzLl9jb250cm9sV3JhcHBlci5zZXRPcHRpb25zKHRoaXMub3B0aW9ucyB8fCB7fSk7XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXMuc3RhdGUpIHtcbiAgICAgIHRoaXMuX2NvbnRyb2xXcmFwcGVyLnNldFN0YXRlKHRoaXMuc3RhdGUgfHwge30pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ29udHJvbFdyYXBwZXIoKSB7XG4gICAgdGhpcy5fY29udHJvbFdyYXBwZXIgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ29udHJvbFdyYXBwZXIoe1xuICAgICAgY29udGFpbmVySWQ6IHRoaXMuaWQsXG4gICAgICBjb250cm9sVHlwZTogdGhpcy50eXBlLFxuICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICBvcHRpb25zOiB0aGlzLm9wdGlvbnNcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLndyYXBwZXJSZWFkeVN1YmplY3QubmV4dCh0aGlzLl9jb250cm9sV3JhcHBlcik7XG4gIH1cblxuICBwcml2YXRlIGFkZEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5yZW1vdmVBbGxMaXN0ZW5lcnModGhpcy5fY29udHJvbFdyYXBwZXIpO1xuXG4gICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKHRoaXMuX2NvbnRyb2xXcmFwcGVyLCAncmVhZHknLCAoZXZlbnQ6IENoYXJ0UmVhZHlFdmVudCkgPT5cbiAgICAgIHRoaXMucmVhZHkuZW1pdChldmVudClcbiAgICApO1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcih0aGlzLl9jb250cm9sV3JhcHBlciwgJ2Vycm9yJywgKGV2ZW50OiBDaGFydEVycm9yRXZlbnQpID0+XG4gICAgICB0aGlzLmVycm9yLmVtaXQoZXZlbnQpXG4gICAgKTtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIodGhpcy5fY29udHJvbFdyYXBwZXIsICdzdGF0ZWNoYW5nZScsIChldmVudDogdW5rbm93bikgPT5cbiAgICAgIHRoaXMuc3RhdGVDaGFuZ2UuZW1pdChldmVudClcbiAgICApO1xuICB9XG59XG4iXX0=